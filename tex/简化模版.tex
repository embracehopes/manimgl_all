\documentclass{ctexart}

% --- 导入所需宏包 ---
\usepackage[a4paper, vmargin=2.5cm, hmargin=2cm]{geometry}
\usepackage{amsmath, amssymb, amsthm}
\usepackage[svgnames]{xcolor}
\usepackage[most]{tcolorbox}
\usepackage{fancyhdr}
\usepackage{lmodern} % 提供更多字体变体，包括粗斜体无衬线字体
\usepackage{tikz}
\usetikzlibrary{intersections, patterns, shadows, decorations.pathmorphing}
\usepackage{fontawesome5} % 更新的图标包
\usepackage{enumitem}
\usepackage{mdframed}
\usepackage{varwidth} % 用于varwidth环境
\usepackage{background} % 用于添加水印

% --- 修复页眉高度警告 ---
\setlength{\headheight}{22pt}

% --- 水印设置 ---
\backgroundsetup{
    scale=1,
    color=black,
    opacity=0.08,
    angle=0,
    position=current page.center,
    vshift=0cm,
    hshift=0cm,
    contents={%
        \begin{tikzpicture}[remember picture, overlay]
            % 使用页面尺寸计算水印位置，确保完全覆盖
            % A4纸尺寸：210mm × 297mm，转换为cm约为21cm × 29.7cm
            \foreach \x in {-12,-8,-4,0,4,8,12} {
                \foreach \y in {-16,-12,-8,-4,0,4,8,12,16} {
                    % 30度倾斜，2.5倍正文字体大小的水印
                    \node[rotate=30, text opacity=0.8, text=gray!50] at (\x cm,\y cm) 
                        {\fontsize{30}{36}\selectfont\sffamily\bfseries 雪履千山客};
                }
            }
        \end{tikzpicture}
    }
}

% --- 自定义优雅颜色定义 ---
\definecolor{themeblue}{RGB}{52, 73, 94}%主题蓝
\definecolor{elegantpurple}{RGB}{155, 89, 182}%优雅紫
\definecolor{warmorange}{RGB}{230, 126, 34}%温暖橙
\definecolor{forestgreen}{RGB}{39, 174, 96}%森林绿
\definecolor{deepblue}{RGB}{41, 128, 185}%深邃蓝
\definecolor{sunsityellow}{RGB}{241, 196, 15}%阳光黄
\definecolor{lightgrayblue}{RGB}{236, 240, 241}%浅灰蓝
\definecolor{softpink}{RGB}{250, 219, 216}%柔和粉
\definecolor{crimsonred}{RGB}{220, 20, 60}%深红
\definecolor{darkslategray}{RGB}{47, 79, 79}%深石板灰
\definecolor{notegreen}{RGB}{39, 174, 96}%注意绿

% --- 页面布局与页眉页脚设置 ---
\pagestyle{fancy}
\fancyhf{}
\fancyhead[L]{\color{crimsonred}\textit{\faBook\ High School Mathematics Handout }}
\fancyhead[R]{\color{crimsonred}\textit{雪履千山客 \faUser}}
\fancyfoot[C]{\color{crimsonred!70}\small\textbf{--\ \thepage\ --}}
\renewcommand{\headrulewidth}{1pt}
\renewcommand{\footrulewidth}{0pt}
\renewcommand{\headrule}{\hbox to\headwidth{\color{crimsonred!30}\leaders\hrule height \headrulewidth\hfill}}

% --- 自定义优美的文本框环境 ---

% 主标题框 (斜体英文+中文，专业设计)
\newtcolorbox{chaptertitle}[2]{
    enhanced,
    colback=themeblue!8!white,
    colframe=white,
    boxrule=0pt,
    arc=0pt,
    outer arc=0pt,
    width=0.90\textwidth,
    fonttitle=\Huge\sffamily,
    title={\makebox[1.8em][l]{\textcolor{themeblue}{#1}}\ \textbf{\textit{{#2}}}},
    coltitle=themeblue,
    center title,
    toptitle=0pt,
    bottomtitle=0pt,
    before skip=0pt,
    after skip=0pt
}

% 习题框 (专业方正设计，左侧竖线，优化对齐)
\newtcolorbox{examplebox}[1]{
    enhanced,
    colback=forestgreen!5!white,
    colframe=white,
    boxrule=0pt,
    arc=0pt,
    outer arc=0pt,
    fonttitle=\bfseries\sffamily,
    title={\makebox[1.8em][l]{\textcolor{forestgreen}{\faEdit}}\ \textit{\textcolor{white}{Example}}},
    coltitle=forestgreen!90!white,
    colbacktitle=forestgreen!35!white,
    attach boxed title to top left={yshift=-2mm, xshift=3mm},
    boxed title style={arc=0pt, outer arc=0pt, frame hidden},
    borderline west={1pt}{0pt}{forestgreen},
    left=15pt, right=10pt, top=15pt, bottom=10pt,
    before skip=20pt, after skip=15pt,
    breakable
}

% 解析框 (专业方正设计，左侧竖线，优化对齐)
\newtcolorbox{analysisbox}{
    enhanced,
    colback=elegantpurple!5!white,
    colframe=white,
    boxrule=0pt,
    arc=0pt,
    outer arc=0pt,
    fonttitle=\bfseries\sffamily,
    title={\makebox[1.8em][l]{\textcolor{elegantpurple}{\faLightbulb}}\ \textit{\textcolor{white}{Analysis}}},
    coltitle=elegantpurple!90!white,
    colbacktitle=elegantpurple!35!white,
    attach boxed title to top left={yshift=-2mm, xshift=3mm},
    boxed title style={arc=0pt, outer arc=0pt, frame hidden},
    borderline west={1pt}{0pt}{elegantpurple},
    left=15pt, right=10pt, top=15pt, bottom=10pt,
    before skip=20pt, after skip=15pt,
    breakable
}

% 拓展框 (专业方正设计，左侧竖线，优化对齐)
\newtcolorbox{expandbox}{
    enhanced,
    colback=warmorange!8!white,
    colframe=white,
    boxrule=0pt,
    arc=0pt,
    outer arc=0pt,
    fonttitle=\bfseries\sffamily,
    title={\makebox[1.8em][l]{\textcolor{warmorange}{\faRocket}}\ \textit{\textcolor{white}{Extension}}},
    coltitle=warmorange!90!white,
    colbacktitle=warmorange!35!white,
    attach boxed title to top left={yshift=-2mm, xshift=3mm},
    boxed title style={arc=0pt, outer arc=0pt, frame hidden},
    borderline west={1pt}{0pt}{warmorange},
    left=15pt, right=10pt, top=15pt, bottom=10pt,
    before skip=20pt, after skip=15pt,
    breakable
}

% 定理框 (新增，优雅设计)
\newtcolorbox{theorembox}[1]{
    enhanced,
    colback=deepblue!8!white,
    colframe=white,
    boxrule=0pt,
    arc=0pt,
    outer arc=0pt,
    fonttitle=\bfseries\sffamily,
    title={\makebox[1.8em][l]{\textcolor{deepblue}{\faGraduationCap}}\ \textit{\textcolor{white}{Theorem}} },
    coltitle=deepblue!90!white,
    colbacktitle=deepblue!35!white,
    attach boxed title to top left={yshift=-2mm, xshift=3mm},
    boxed title style={arc=0pt, outer arc=0pt, frame hidden},
    borderline west={1pt}{0pt}{deepblue},
    left=15pt, right=10pt, top=15pt, bottom=10pt,
    before skip=20pt, after skip=15pt,
    breakable
}

% 注意事项框 (新增，警示设计)
\newtcolorbox{notebox}{
    colback=white,
    title={\makebox[1.8em][l]{\textcolor{crimsonred}{\faExclamationTriangle}}\ \textit{Note}},
    colframe=white,
    boxrule=0pt,
    enhanced,
    title style={left color=crimsonred!50,right color=white,middle color=white},
    arc=0mm,
    titlerule=0pt,
    fonttitle=\bfseries\sffamily,
    left=15pt, right=10pt, top=15pt, bottom=10pt,
    before skip=20pt, after skip=15pt,
    breakable
}

% 习题框 (新增，专业设计)
\newtcolorbox{exercisebox}[1]{
    enhanced,
    title={\makebox[1.8em][l]{\textcolor{forestgreen}{\faClock}}\ \textit{Exercise} \quad {\textcolor{forestgreen}{\faClock}} #1},
    colframe=forestgreen!50!black,
    colback=forestgreen!10!white,
    colbacktitle=forestgreen!5!yellow!10!white,
    fonttitle=\bfseries\sffamily,
    coltitle=forestgreen!50!black,
    attach boxed title to top center={yshift=-0.25mm-\tcboxedtitleheight/2,yshifttext=2mm-\tcboxedtitleheight/2},
    boxed title style={boxrule=0.5mm,
        frame code={ \path[tcb fill frame] ([xshift=-4mm]frame.west)
            -- (frame.north west) -- (frame.north east) -- ([xshift=4mm]frame.east)
            -- (frame.south east) -- (frame.south west) -- cycle; },
        interior code={ \path[tcb fill interior] ([xshift=-2mm]interior.west)
            -- (interior.north west) -- (interior.north east)
            -- ([xshift=2mm]interior.east) -- (interior.south east) -- (interior.south west)
            -- cycle;} },
    left=15pt, right=10pt, top=15pt, bottom=10pt,
    before skip=20pt, after skip=15pt,
    breakable
}

%公式框 (新增，数学公式优化设计)
\newtcolorbox{formulabox}{
     enhanced,
    skin=enhancedlast jigsaw,
    attach boxed title to top left={xshift=-4mm,yshift=-0.5mm},
    fonttitle=\bfseries\sffamily,
    varwidth boxed title=0.7\linewidth,
    colbacktitle=blue!45!white,
    colframe=red!50!black,
    interior style={top color=blue!10!white,bottom color=red!10!white},
    boxed title style={empty,arc=0pt,outer arc=0pt,boxrule=0pt},
    underlay boxed title={
        \fill[blue!45!white] (title.north west) -- (title.north east)
        -- +(\tcboxedtitleheight-1mm,-\tcboxedtitleheight+1mm)
        -- ([xshift=4mm,yshift=0.5mm]frame.north east) -- +(0mm,-1mm)
        -- (title.south west) -- cycle;
        \fill[blue!45!white!50!black] ([yshift=-0.5mm]frame.north west)
        -- +(-0.4,0) -- +(0,-0.3) -- cycle;
        \fill[blue!45!white!50!black] ([yshift=-0.5mm]frame.north east)
        -- +(0,-0.3) -- +(0.4,0) -- cycle; 
    },
    title={\makebox[1.8em][l]{\textcolor{warmorange}{\faRocket}}\ \textit{\textcolor{white}{Formula}}},
    left=15pt, right=10pt, top=15pt, bottom=10pt,
    before skip=20pt, after skip=15pt,
    breakable,
}

%总结框
\newtcolorbox{summarybox}{
    colback=Teal!30!white,
    enhanced,
    title={\makebox[1.8em][l]{\textcolor{pink!90!white}{\faCodepen}}\ \textit{Summary}},
    attach boxed title to top left={xshift=-4mm},
    fonttitle=\bfseries\sffamily,
    toprule=0pt,
    bottomrule=0pt,
    rightrule=0pt,
    leftrule=3pt,
    arc=0mm,
    skin=enhancedlast jigsaw,
    sharp corners,
    colframe=Teal!90!white,
    colbacktitle=Teal!90!white,
    boxed title style={
        frame code={
            \fill[Teal!90!white](frame.south west)--(frame.north west)--(frame.north east)--([xshift=3mm]frame.east)--(frame.south east)--cycle;
            \draw[line width=1mm,Teal!90!white]([xshift=2mm]frame.north east)--([xshift=5mm]frame.east)--([xshift=2mm]frame.south east);
            \draw[line width=1mm,Teal!90!white]([xshift=5mm]frame.north east)--([xshift=8mm]frame.east)--([xshift=5mm]frame.south east);
            \fill[green!40](frame.south west)--+(4mm,-2mm)--+(4mm,2mm)--cycle;
        }
    },
    left=15pt, right=10pt, top=15pt, bottom=10pt,
    before skip=20pt, after skip=15pt,
    breakable
}




% --- 数学公式和排版优化 ---
\renewcommand{\arraystretch}{1.4}
\setlength{\jot}{8pt}

% 自定义数学命令
\newcommand{\highlight}[1]{\colorbox{sunsityellow!20}{\ensuremath{#1}}}
\newcommand{\result}[1]{\tcbhighmath[colback=deepblue!15, colframe=deepblue, arc=3pt]{#1}}
\newcommand{\important}[1]{\textcolor{crimsonred}{\textbf{#1}}}

% --- 文档开始 ---
\begin{document}
\thispagestyle{fancy}

% 优美的章节标题 (主标题斜体英文+中文)
\begin{center}
    \begin{chaptertitle}{\faBookOpen}{Analytic Geometry 4.1}
    \end{chaptertitle}
\end{center}


\begin{theorembox}{4.1}
\textbf{圆锥曲线的统一定义：} 平面内与一定点（焦点）和一条定直线（准线）的距离比为常数 $e$（离心率）的点的轨迹称为圆锥曲线。

当 $0 < e < 1$ 时为椭圆；当 $e = 1$ 时为抛物线；当 $e > 1$ 时为双曲线。
\end{theorembox}

\begin{examplebox}{4.1}
已知椭圆 $\frac{x^2}{a^2} + \frac{y^2}{b^2} = 1$ (其中 $a > b > 0$) 的离心率为 $\frac{\sqrt{3}}{2}$，且过点 $(2, 1)$。

(1) 求椭圆的标准方程；

(2) 设直线 $l: y = kx + m$ 与椭圆相交于 $A$、$B$ 两点，若 $A$、$B$ 关于直线 $y = 2x$ 对称，求直线 $l$ 的方程。
\end{examplebox}

\begin{analysisbox}
\textbf{\color{elegantpurple}\textit{Solution Strategy} \quad 解题思路：}

\begin{enumerate}[leftmargin=15pt, itemsep=8pt]
    \item \textbf{第一问：} 利用离心率公式 $e = \frac{c}{a}$ 和椭圆过定点条件建立方程组
    
    \item \textbf{第二问：} 利用对称性质，若两点关于直线对称，则：
    
    \begin{itemize}
        \item 连线中点在对称轴上
        \item 连线斜率与对称轴斜率乘积为 $-1$
    \end{itemize}
\end{enumerate}

\medskip
\textbf{\color{elegantpurple}\textit{Detailed Calculation} \quad 具体计算：}

\textbf{第一问：} 由 $e = \frac{\sqrt{3}}{2}$，得 $\frac{c}{a} = \frac{\sqrt{3}}{2}$，即 $c^2 = \frac{3a^2}{4}$。

由 $c^2 = a^2 - b^2$，得 $b^2 = a^2 - c^2 = \frac{a^2}{4}$。

椭圆过点 $(2, 1)$，代入得：$\frac{4}{a^2} + \frac{1}{b^2} = 1$

将 $b^2 = \frac{a^2}{4}$ 代入：$\frac{4}{a^2} + \frac{4}{a^2} = 1$

解得 $a^2 = 8$，$b^2 = 2$。

\result{\text{椭圆方程：} \frac{x^2}{8} + \frac{y^2}{2} = 1}

\textbf{第二问：} 设 $A(x_1, y_1)$，$B(x_2, y_2)$，中点 $M\left(\frac{x_1+x_2}{2}, \frac{y_1+y_2}{2}\right)$。

由对称性质：
\begin{align}
&\text{中点在对称轴上：} \frac{y_1+y_2}{2} = 2 \cdot \frac{x_1+x_2}{2} \\
&\text{斜率关系：} k \cdot 2 = -1，\text{即} k = -\frac{1}{2}
\end{align}

联立椭圆方程与直线方程，利用韦达定理可得：
\result{y = -\frac{1}{2}x + 1}
\end{analysisbox}

\begin{notebox}
\important{解题要点：}
\begin{itemize}[leftmargin=15pt, itemsep=5pt]
    \item 对称问题的核心在于利用对称轴的性质
    \item 椭圆离心率 $e = \frac{c}{a}$ 是连接 $a$、$b$、$c$ 的桥梁
    \item 联立方程时要注意判别式 $\Delta > 0$ 的条件
\end{itemize}
\end{notebox}

\begin{figure}[h!]
\centering
\begin{tikzpicture}[scale=0.8, >=stealth]
    % 定义椭圆参数
    \def\a{2.83} % sqrt(8)
    \def\b{1.41} % sqrt(2)
    
    % 绘制坐标轴
    \draw[->] (-4,0) -- (4,0) node[right] {$x$};
    \draw[->] (0,-2.5) -- (0,2.5) node[above] {$y$};
    
    % 绘制椭圆
    \draw[thick, blue] (0,0) ellipse ({\a} and {\b});
    
    % 绘制对称轴
    \draw[dashed, red, thick] (-3,-6) -- (2,4) node[above] {$y = 2x$};
    
    % 绘制直线l
    \draw[green, thick] (-2,2) -- (4,-1) node[right] {$l: y = -\frac{1}{2}x + 1$};
    
    % 标记交点
    \coordinate (A) at (-1.6, 1.8);
    \coordinate (B) at (2.4, -0.2);
    \fill[green] (A) circle (2pt) node[above left] {$A$};
    \fill[green] (B) circle (2pt) node[below right] {$B$};
    
    % 标记中点
    \coordinate (M) at (0.4, 0.8);
    \fill[red] (M) circle (2pt) node[above] {$M$};
    
    % 标记原点和关键点
    \fill (0,0) circle (1.5pt) node[below left] {$O$};
    \fill (2,1) circle (2pt) node[above right] {$(2,1)$};
    
    % 添加网格
    \draw[gray!30, very thin] (-4,-2) grid (4,2);
    
\end{tikzpicture}
\caption{\textcolor{themeblue}{\textbf{\textit{Figure 4.1 - Ellipse and Symmetric Line} \quad 图 4.1 - 椭圆与对称直线}}}
\label{fig:ellipse}
\end{figure}

\begin{expandbox}
\textbf{拓展思考：}

\begin{enumerate}[leftmargin=15pt, itemsep=8pt]
    \item \textbf{一般化问题：} 若椭圆上两点关于直线 $y = kx + c$ 对称，如何求解？
    
    \item \textbf{双曲线情形：} 类似问题在双曲线中如何处理？
    
    \item \textbf{参数方程法：} 利用椭圆的参数方程 $\begin{cases} x = a\cos\theta \\ y = b\sin\theta \end{cases}$ 求解对称问题
\end{enumerate}

\textbf{相关定理：}
\begin{itemize}[leftmargin=15pt, itemsep=5pt]
    \item 焦点弦性质：过焦点的弦具有特殊的调和性质
    \item 切线方程：椭圆上一点的切线方程为 $\frac{x_0 x}{a^2} + \frac{y_0 y}{b^2} = 1$
\end{itemize}
\end{expandbox}

\newpage

% 第二个主题
\begin{center}
    \begin{chaptertitle}{\faInfinity}{Infinite Series 5.2}
    \end{chaptertitle}
\end{center}

\begin{summarybox}{5.1}
设数列 $\{a_n\}$ 满足 $a_1 = 1$，$a_{n+1} = \frac{2a_n}{a_n + 2}$ $(n \geq 1)$。

(1) 证明：$\frac{1}{a_n}$ 是等差数列；

(2) 求数列 $\{a_n\}$ 的通项公式；

(3) 求 $\sum_{n=1}^{\infty} a_n$ 的值。
\end{summarybox}

\begin{formulabox}
\textbf{\color{elegantpurple}\textit{Analysis Method} \quad 分析方法：}

这是典型的递推数列问题，关键在于找到合适的变换使得新数列具有简单的递推关系。

\textbf{第一问：} 对递推关系取倒数：
$$\frac{1}{a_{n+1}} = \frac{a_n + 2}{2a_n} = \frac{1}{2} + \frac{1}{a_n}$$

设 $b_n = \frac{1}{a_n}$，则 $b_{n+1} = b_n + \frac{1}{2}$，$b_1 = 1$。

显然 $\{b_n\}$ 是首项为 $1$，公差为 $\frac{1}{2}$ 的等差数列。

\textbf{第二问：} 
$$b_n = 1 + (n-1) \cdot \frac{1}{2} = \frac{n+1}{2}$$

因此：

\textbf{第三问：} 
$$\sum_{n=1}^{\infty} a_n = \sum_{n=1}^{\infty} \frac{2}{n+1} = 2\sum_{n=2}^{\infty} \frac{1}{n}$$

此级数发散（调和级数）。
\end{formulabox}

\begin{exercisebox}
\important{级数收敛性判断：}
\begin{itemize}[leftmargin=15pt, itemsep=5pt]
    \item 调和级数 $\sum_{n=1}^{\infty} \frac{1}{n}$ 发散
    \item $p$-级数 $\sum_{n=1}^{\infty} \frac{1}{n^p}$ 当 $p > 1$ 时收敛，$p \leq 1$ 时发散
    \item 比值判别法和根值判别法的应用条件
\end{itemize}
\end{exercisebox}

\setcounter{page}{150}

\end{document}
